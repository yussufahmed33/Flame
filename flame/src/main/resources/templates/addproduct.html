<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/>
    <title>Add Product</title>
    <style>
        body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:#f8fafc;margin:0}
        .wrap{max-width:720px;margin:2rem auto;padding:1.25rem;background:#fff;border:1px solid #e5e7eb;border-radius:10px}
        h1{margin:0 0 1rem 0;font-size:1.5rem;color:#111827}
        .grid{display:grid;grid-template-columns:1fr 1fr;gap:1rem}
        .full{grid-column:1/-1}.field{margin:.5rem 0}
        label{display:block;font-size:.85rem;color:#374151;margin-bottom:.25rem}
        input,textarea{width:100%;padding:.65rem;border:1px solid #d1d5db;border-radius:6px;font-size:.95rem;background:#fff}
        textarea{min-height:120px;resize:vertical}
        button{padding:.8rem 1rem;border:0;background:#111827;color:#fff;border-radius:6px;cursor:pointer}
        .msg{margin:.5rem 0;padding:.6rem;border-radius:6px;font-size:.875rem}
        .ok{background:#dcfce7;color:#166534}.err{background:#fee2e2;color:#991B1B}
        .preview{border:1px dashed #cbd5e1;border-radius:8px;padding:.75rem;text-align:center;margin-top:.5rem}
        img{max-width:100%;height:auto;border-radius:6px}
        .hint{font-size:.8rem;color:#6b7280}@media(max-width:740px){.grid{grid-template-columns:1fr}}
    </style>
    <script>
        function previewImage(evt){
            const file = evt.target.files && evt.target.files[0];
            const box = document.getElementById('prevBox');
            const img = document.getElementById('imgPrev');
            if(file){
                img.src = URL.createObjectURL(file);
                box.style.display='block';
            }else{
                img.removeAttribute('src');
                box.style.display='none';
            }
        }
        function validatePrice(e){
            const v = e.value;
            if(!/^\d+(\.\d{0,2})?$/.test(v)) e.value = v.replace(/[^0-9.]/g,'').replace(/(\..*)\./g,'$1');
        }
    </script>
</head>
<body>
<div class="wrap">
    <h1>Add Product / إضافة منتج</h1>
    <div th:if="${created}" class="msg ok">Product created successfully. / تم إنشاء المنتج بنجاح.</div>
    <div th:if="${imgErr}" class="msg err" th:text="${imgErr}"></div>

    <form method="post" th:action="@{/admin/addproduct}" th:object="${product}" enctype="multipart/form-data">
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

        <div class="grid">
            <div class="field">
                <label>Name / الاسم</label>
                <input type="text" th:field="*{name}" required />
            </div>
            <div class="field">
                <label>Category / الفئة</label>
                <input type="text" th:field="*{category}" required />
            </div>
            <div class="field">
                <label>Price / السعر</label>
                <input type="text" th:field="*{price}" inputmode="decimal" oninput="validatePrice(this)" required />
                <div class="hint">Two decimals max / حد أقصى منزلتان عشريتان</div>
            </div>
            <div class="field full">
                <label>Description / الوصف</label>
                <textarea th:field="*{description}" required></textarea>
            </div>
            <div class="field full">
                <label>Image file / ملف الصورة</label>
                <input id="imageFile" type="file" name="productImages" accept="image/*" onchange="previewImage(event)" required />
                <div id="prevBox" class="preview" style="display:none;">
                    <img id="imgPrev" alt="preview"/>
                </div>
                <div class="hint">Allowed: images. سيتم حفظها في /uploads/</div>
            </div>
        </div>

        <div style="margin-top:.75rem;display:flex;gap:.75rem;align-items:center;flex-wrap:wrap">
            <button type="submit">Save / حفظ</button>
            <a href="/" style="text-decoration:underline;color:#111827">Home / الرئيسية</a>
        </div>
    </form>

</div>
</body>
</html>